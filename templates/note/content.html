<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<meta name="author" content="作者">
	<title>{{.Title}}</title>
	<meta name="viewport" content="width=device-width,user-scalable=no">
	<meta name="referrer" content="always">
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link href='/css/base.css' rel="stylesheet" type="text/css">
	<link href='/css/prism.css' rel="stylesheet">
	<script src='/js/prism.js' async></script>
</head>
<body>
	{{template "header" .}}
	<div class="container repository-content">
		<div class="note">
			<div class="note-header">
				<div class="note-title"><h1{{if ge .Level 30}} ondblclick="edit()"{{end}}>{{.Note.Title}}</h1></div>
				<div class="note-actions">
				</div>
				<div class="note-info">
					<span>作者:</span>
					<span>时间:{{.Note.EditTime}}</span>
				</div>
			</div>
			<div id="editor" class="note-content note-format-{{.Note.Format}}">
				{{.Note.ToHTML}}
			</div>
		</div>
	</div>
	{{template "footer"}}
	{{if ge .Level 30}}
	<script type="text/javascript">
		"use strict";
		loadScript = function(fileName, callback, into) {
        
	        into          = into     || "head";
	        callback      = callback || function() {};
	        
	        var script    = null; 
	        script        = document.createElement("script");
	        script.id     = fileName.replace(/[\./]+/g, "-");
	        script.type   = "text/javascript";        
	        script.src    = fileName + ".js";
	        
	        if (editormd.isIE8) 
	        {            
	            script.onreadystatechange = function() {
	                if(script.readyState) 
	                {
	                    if (script.readyState === "loaded" || script.readyState === "complete") 
	                    {
	                        script.onreadystatechange = null; 
	                        editormd.loadFiles.js.push(fileName);
	                        callback();
	                    }
	                } 
	            };
	        }
	        else
	        {
	            script.onload = function() {
	                editormd.loadFiles.js.push(fileName);
	                callback();
	            };
	        }

	        if (into === "head") {
	            document.getElementsByTagName("head")[0].appendChild(script);
	        } else {
	            document.body.appendChild(script);
	        }
	    };

		var editor;
		function edit() {
			loadScript("/js/editor.js",function(){
				//<script src="/js/editor.js"><//script>
				editor = new window.Editor('#editor')
				editor.customConfig.uploadImgShowBase64 = true
				editor.create()
			})
		}

		function commit(){
			fetch({{.Uri}},{ method: 'PUT',credentials: 'include', body: editor.txt.html()}).then(function(response) {
				if (!response.ok) throw new Error(response.statusText)
				return response.json()
			}).then(function(data){
				console.log(data)
			}).catch(function(err) {
				console.log(err)
			})
		}
	</script>
	{{end}}
</body>
</html>
